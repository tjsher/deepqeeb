# DeepQeeb 功能定义

## 1. 核心概念与工作流

### 1.1 项目结构 (Scripts)
- **Script (剧本)** 是系统的顶层项目单位。
- 用户登录后，首屏展示当前用户拥有的所有 Script 列表。
- 提供 "创作" 按钮：点击后创建一个新的 Script (生成 `script_id`) 并跳转到工作台。

### 1.2 工作台 (Workspace)
工作台包含以下核心区域，通过 `script_id` 进行 1:1 绑定：

1.  **文件资源管理器 (File Explorer)**:
    -   **虚拟文件系统**: 对应数据库中存储的文件树，但在操作体验上模拟本地文件系统。
    -   **功能**:
        -   新建文件夹。
        -   新建文件 (目前仅支持 `.md`)。
        -   展示所有类型文件 (包括 AI 生成的代码文件等)。
        -   支持 Agent 对文件树的增删改查。

2.  **对话面板 (Chat Panel)**:
    -   **对话历史**: 每个 Script 可以包含多个对话历史记录 (`history_id` / conversation)。
    -   **Agent 模式切换**: 可以在对话中切换两种 Agent 模式（本质是不同的 System Prompt 和 Tools 集合）：
        -   **剧本 Agent (Script Agent)**: 专注于剧本创作。
        -   **游戏生成 Agent (Game Gen Agent)**: 专注于将剧本转换为游戏代码。

3.  **内容编辑/预览区**:
    -   展示当前选中的文件内容。
    -   支持 Diff View：当 Agent 提议修改文件时，展示 Git 风格的差异对比，由用户决定 "接受" 或 "拒绝"。

## 2. Agent 定义

### 2.1 剧本 Agent (Script Agent)
- **目标**: 辅助用户创作、修改和润色剧本。
- **能力 (Tools)**:
    -   `read_file_tree`: 查看文件树结构。
    -   `search_files`: 搜索剧本相关文件。
    -   `edit_file`: 编辑文件内容 (触发 Diff 确认流程)。
    -   `save_file`: 保存文件。
    -   `read_skills`: 读取剧本创作相关的技巧/Prompt 库。

### 2.2 游戏生成 Agent (Game Generation Agent)
- **目标**: 根据剧本内容生成对应的网页游戏代码。
- **能力 (Tools)**:
    -   `read_file_tree`: 查看代码和资源文件。
    -   `search_files`: 搜索代码文件。
    -   `edit_file`: 编写/修改代码文件 (触发 Diff 确认流程)。
    -   `save_file`: 保存代码。
    -   `read_skills`: 读取游戏开发相关的代码片段和技巧库。

## 3. runtime (Agent C) - 文字游戏引擎
*(保留原有设计)*
- 游戏生成后，通过独立的 Share Link 运行。
- Backend Agent (Assistant) 驱动游戏剧情和状态。
- 使用 XML 标签控制角色输出和状态更新。

## 4. 数据模型变更
- 新增 `scripts` 表作为项目根节点。
- `files` 表关联至 `script_id` 而非直接关联 `user_id`。
- `conversations` 表关联至 `script_id`。
  - 不再区分 conversation 的 `type` (game/script)，而是作为通用容器，记录当前的 Agent Mode。